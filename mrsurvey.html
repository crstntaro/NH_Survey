<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marudori Survey — Nippon Hasha</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --font:"Montserrat",system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
      --accent:#ff6b35;
      --accent-dk:#d85626;
      --ink:#101010; --muted:#6b7280;
      --line:#e5e7eb; --bg:#faf6ef; --surface:#ffffff;
      --header-h:72px;
      --sea1:.12; --sea2:.05;
      --hero-decor-left:url('maru-left.png');
      --hero-decor-right:url('maru-right.png');
      --ease:cubic-bezier(.22,.61,.36,1);
      --dur:.26s;
    }
    *{ box-sizing:border-box }
    html,body{ min-height:100% }
    body{
      margin:0; font-family:var(--font); color:var(--ink); background:var(--bg);
      line-height:1.6; overflow-x:hidden; opacity:0; transform:translateY(8px); animation:fadeIn .45s ease forwards;
    }
    @keyframes fadeIn{ to{ opacity:1; transform:none } }
    .bg{ position:fixed; inset:0; z-index:-3;
      background: radial-gradient(1200px 360px at 50% -120px, rgba(255,107,53,.14), transparent 65%), var(--bg);
    }
    .bg::before, .bg::after{
      content:""; position:absolute; inset:0; pointer-events:none;
      background-repeat:repeat; background-size:400px 200px; animation: float 34s linear infinite;
    }
    .bg::before{
      opacity:var(--sea1);
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="150" viewBox="0 0 300 150"><defs><pattern id="s" width="50" height="25" patternUnits="userSpaceOnUse"><path d="M0 25a25 25 0 0 1 50 0" fill="none" stroke="%23ff6b35" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23s)"/></svg>');
    }
    .bg::after{
      opacity:var(--sea2); animation-duration:48s; animation-direction:reverse; transform:translateY(10px);
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="150" viewBox="0 0 300 150"><defs><pattern id="s" width="50" height="25" patternUnits="userSpaceOnUse"><path d="M0 25a25 25 0 0 1 50 0" fill="none" stroke="%23101010" stroke-width=".9" opacity=".25"/><path d="M12.5 25a12.5 12.5 0 0 1 25 0" fill="none" stroke="%23101010" stroke-width=".6" opacity=".18"/></pattern></defs><rect width="100%" height="100%" fill="url(%23s)"/></svg>');
    }
    @keyframes float{ from{ background-position:0 0 } to{ background-position:400px 0 } }
    .site-header{
      position:sticky; top:0; height:var(--header-h);
      display:flex; align-items:center; z-index:10;
      backdrop-filter:saturate(180%) blur(6px);
      background:color-mix(in oklab, var(--surface) 88%, transparent);
      border-bottom:1px solid var(--line);
    }
    .nav{ max-width:1200px; margin:0 auto; padding:0 16px; width:100%;
      display:flex; justify-content:space-between; align-items:center; height:100% }
    .brand-left{ display:flex; align-items:center; gap:10px }
    .brand-img{ height:34px; width:auto; display:block }
    .brand-right{ display:flex; flex-direction:column; align-items:flex-end; line-height:1.1; text-align:right }
    .brand-name{ font:800 16px/1 var(--font) }
    .brand-sub{ font:700 11px/1 var(--font); color:var(--muted); letter-spacing:.06em; text-transform:uppercase }
    .hero{
      position:relative;
      min-height:calc(100dvh - var(--header-h));
      display:grid; place-items:center; padding:28px; text-align:center; overflow:hidden;
    }
    .wrap{ max-width:960px; margin:0 auto }
    .hero::before,
    .hero::after{
      content:""; position:fixed; bottom:-60px; width:min(520px,70vw); aspect-ratio:1;
      filter:blur(1px) drop-shadow(0 18px 36px rgba(0,0,0,.12));
      opacity:.22; pointer-events:none; z-index:-1;
      background-position:center; background-repeat:no-repeat; background-size:contain;
      transform:translateZ(0);
    }
    .hero::before{
      left:-80px;
      background-image:var(--hero-decor-left);
      transform:rotate(6deg) translateZ(0);
    }
    .hero::after{
      right:-60px;
      background-image:var(--hero-decor-right);
      transform:rotate(-6deg) translateZ(0);
    }
    .hero-logo{
      display:inline-block; margin:0 auto 10px;
      transform:translateY(8px) scale(.98); opacity:0;
      animation: logoIn .6s var(--ease) .05s forwards;
    }
    .hero-logo img{ width:min(540px,78vw); height:auto; display:block; filter:drop-shadow(0 14px 24px rgba(0,0,0,.12)) }
    @keyframes logoIn{ to{ transform:none; opacity:1 } }
    h1{ margin:8px 0 4px; font:800 clamp(28px,5vw,44px)/1.1 var(--font); letter-spacing:-.2px; opacity:0; transform:translateY(8px); animation: rise .5s ease .12s forwards }
    .subtitle{ font:700 clamp(13px,2.6vw,16px)/1.2 var(--font); color:var(--muted); opacity:0; transform:translateY(8px); animation: rise .5s ease .18s forwards }
    .accent-underline{
      width:0; height:3px; margin:10px auto 0;
      background:linear-gradient(90deg, transparent 0%, var(--accent) 15%, var(--accent-dk) 85%, transparent 100%);
      border-radius:999px; opacity:.9; animation: underline .7s ease .18s forwards;
    }
    @keyframes underline{ to{ width:180px } }
    @keyframes rise{ to{ opacity:1; transform:none } }
    .strap-hero{
      display:inline-flex; gap:10px; align-items:center; margin:14px 0 22px; color:var(--accent);
      font-weight:800; font-size:12px; letter-spacing:.12em; text-transform:uppercase; padding:8px 16px;
      border:1px solid color-mix(in srgb, var(--accent) 35%, transparent);
      border-radius:999px; background:color-mix(in srgb, var(--accent) 8%, transparent);
    }
    .lead{ color:#4b5563; font-size:clamp(15px,2.4vw,18px); max-width:650px; margin:0 auto 22px }
    .cta{
      display:inline-flex; align-items:center; gap:12px; padding:14px 28px; border-radius:16px;
      font:800 16px/1 var(--font); color:#fff; text-decoration:none; letter-spacing:.2px;
      background: var(--accent); border:1px solid rgba(0,0,0,.08);
      box-shadow:0 16px 32px color-mix(in srgb,var(--accent) 28%, transparent);
      transition:transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .cta:hover{ transform:translateY(-2px); box-shadow:0 20px 40px color-mix(in srgb, var(--accent) 36%, transparent) }
    .viewport{
      position:relative;
      min-height:calc(100dvh - var(--header-h));
      display:none; align-items:center; justify-content:center;
      padding:20px 16px; overflow:hidden;
    }
    .card{
      width:min(760px,100%);
      background:var(--surface); border:1px solid var(--line); border-radius:20px;
      box-shadow:0 16px 48px rgba(0,0,0,.08); padding:14px; position:relative; overflow:hidden;
    }
    .progress{ display:none }
    .step-meta{display:flex; align-items:center; gap:12px; justify-content:center; margin-bottom:14px}
    .step-chip{font:800 12px var(--font); color:#7a2f16; padding:6px 12px; border-radius:999px; background:#fff1ea; border:1px solid #fdd2bb; letter-spacing:.08em; text-transform:uppercase}
    .step-mini{flex:1; max-width:200px; height:8px; background:#ffe7dc; border-radius:999px; overflow:hidden}
    .step-mini div{height:100%; width:0; background:linear-gradient(90deg,var(--accent),var(--accent-dk)); transition:width .25s var(--ease)}
    .step-hdr{ display:flex; align-items:center; justify-content:center; margin-bottom:8px; text-align:center }
    .step-title{ font:800 clamp(18px,2.8vw,22px)/1.25 var(--font); max-width:680px }
    .stage{
      position:relative; overflow:hidden; background:var(--surface);
      height:auto; transition:height var(--dur) var(--ease);
    }
    .stage.dropdown-open{ overflow:visible; }
    .step{
      position:absolute; inset:0; padding:10px 0 0;
      opacity:0; pointer-events:none;
      transform:translateX(12px);
      overflow:auto; -webkit-overflow-scrolling: touch;
    }
    .step.active{
      opacity:1; transform:none; pointer-events:auto; z-index:2;
      transition:opacity var(--dur) var(--ease), transform var(--dur) var(--ease);
      position:relative;
    }
    .step.exiting-left, .step.exiting-right{
      opacity:0; pointer-events:none; z-index:3;
      transition:opacity var(--dur) var(--ease), transform var(--dur) var(--ease);
    }
    .step.exiting-left{ transform:translateX(-12px) }
    .step.exiting-right{ transform:translateX(12px) }
    .step.entering-left{ transform:translateX(-12px) }
    .step.entering-right{ transform:translateX(12px) }
    .step.entering-left.active, .step.entering-right.active{ opacity:1; transform:none }
    .row{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:10px;
      justify-items:stretch;
      margin-top:8px;
      width:min(100%, 680px);
      margin-inline:auto;
    }
    .pill{
      appearance:none; border:1px solid var(--line); background:var(--surface); color:var(--ink);
      padding:0 14px; border-radius:12px; font:800 14px var(--font); cursor:pointer;
      min-height:64px; display:grid; place-items:center; text-align:center;
      transition:transform .12s var(--ease), box-shadow .12s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
    }
    .pill:hover{ transform:translateY(-1px) }
    .pill[aria-pressed="true"]{ background:var(--accent); border-color:var(--accent); color:#fff; box-shadow:0 10px 18px color-mix(in srgb,var(--accent) 38%, transparent) }
    textarea,input[type="text"]{
      width:min(100%, 680px); padding:12px 14px; border:1px solid var(--line); border-radius:12px; background:var(--surface); color:var(--ink); font:600 14px var(--font); margin:6px auto 0; display:block;
    }
    textarea{ min-height:90px; resize:vertical }
    .typeahead{ position:relative; width:min(100%,680px); margin:0 auto }
    .ta-list{
      position:absolute; left:0; right:0; top:calc(100% + 4px);
      background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:0 10px 24px rgba(0,0,0,.08);
      max-height:260px; overflow:auto; z-index:50; display:none;
    }
    .ta-item{ padding:10px 12px; cursor:pointer; font-size:14px }
    .ta-item:hover, .ta-item.active{ background:#ffe7dc; color:#7a2f16 }
    .slider-shell{
      width:100%; max-width:640px; border-radius:28px; background:#fff;
      box-shadow:0 24px 60px color-mix(in srgb, var(--accent) 18%, transparent);
      border:1px solid color-mix(in srgb, var(--accent) 16%, transparent);
      padding:28px 24px 32px; display:grid; gap:18px; justify-items:center; margin:8px auto 0;
    }
    .slider-shell-rating .slider-score{font:800 clamp(44px,9vw,56px)/1 var(--font); color:var(--accent)}
    .slider-shell-rating .slider-score-label{font:700 13px/1.2 var(--font); letter-spacing:.12em; text-transform:uppercase; color:#0f172a}
    .slider-shell-rating .slider-score-label.is-empty{color:#94a3b8}
    .slider-shell-nps .slider-score{font:800 clamp(44px,9vw,56px)/1 var(--font); color:#0f172a}
    .slider-track{position:relative;width:calc(100% - 36px);max-width:800px;margin:0 auto;padding-bottom:12px}
    .slider-lane{position:relative;width:100%;height:12px;border-radius:999px;background:linear-gradient(90deg,color-mix(in srgb,var(--accent) 20%, #fff) 0%,color-mix(in srgb,var(--accent) 6%, #fff) 100%)}
    .slider-fill{position:absolute;left:0;top:0;bottom:0;width:0;border-radius:inherit;background:linear-gradient(90deg,var(--accent) 0%,color-mix(in srgb,var(--accent) 45%, #fff) 100%);transition:width .22s var(--ease)}
    .slider-thumb{position:absolute;top:50%;transform:translate(-50%,-50%);width:var(--thumb-size,clamp(52px,12vw,76px));height:var(--thumb-size,clamp(52px,12vw,76px));display:grid;place-items:center;pointer-events:none}
    .slider-thumb img{width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 18px 36px color-mix(in srgb,var(--accent) 40%, transparent));pointer-events:none}
    .slider-track input[type="range"]{position:absolute;inset:-24px 26px -16px 26px;width:auto;height:auto;opacity:0;cursor:pointer;touch-action:none}
    .slider-ticks{width:100%;display:flex;justify-content:space-between;gap:6px;padding:0 26px;font:700 11px/1.2 var(--font);color:#6b7b8f;text-transform:none;letter-spacing:.08em;max-width:800px;margin:0 auto}
    .slider-ticks span{position:relative;display:grid;justify-items:center;gap:4px;padding-top:10px;white-space:nowrap;text-align:center;transition:color .18s var(--ease)}
    .slider-ticks span::before{content:"";position:absolute;top:0;left:50%;transform:translateX(-50%);width:2px;height:8px;border-radius:999px;background:#d8eef0;transition:background .18s var(--ease),height .18s var(--ease)}
    .slider-ticks span.active{color:var(--accent)}
    .slider-ticks span.active::before{background:var(--accent);height:12px}
    .slider-followup{display:none;width:100%;max-width:640px;margin:12px auto 0;text-align:left}
    .slider-followup label{display:block;font:700 13px/1.4 var(--font);margin-bottom:6px;color:#142a3b;letter-spacing:.04em;text-transform:uppercase}
    .slider-followup textarea{width:100%;min-height:96px;resize:vertical;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;font:500 14px/1.5 var(--font);color:var(--ink);box-shadow:0 12px 32px rgba(0,56,84,.08)}


    .actions{ display:flex; gap:10px; align-items:center; margin-top:10px; padding-top:10px; border-top:1px dashed var(--line); justify-content:center }
    .btn{ display:inline-block; padding:12px 18px; border-radius:12px; font:800 14px/1 var(--font); color:#fff; background:var(--accent); border:1px solid rgba(0,0,0,.08); cursor:pointer; box-shadow:0 10px 18px color-mix(in srgb,var(--accent) 38%, transparent) }
    .btn.alt{ background:#ffe7dc; color:#7a2f16; box-shadow:none }
    .btn[disabled]{ opacity:.55; cursor:not-allowed; box-shadow:none; filter:grayscale(.35) }
    .state{ color:#b45309; font-size:12px; text-align:center; margin-top:6px; min-height:1em }
    .state.ok{ color:#0b7f87 }
    .grid5{ display:grid; grid-template-columns:1fr 1fr; gap:10px; width:min(100%, 680px); margin:8px auto 0 }
    @media (max-width:640px){ .grid5{ grid-template-columns:1fr } }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <header class="site-header">
    <nav class="nav">
      <div class="brand-left">
        <img class="brand-img" src="marudorilogo.png" alt="Marudori">
      </div>
      <div class="brand-right">
        <div class="brand-name">MARUDORI</div>
        <div class="brand-sub">Customer Survey</div>
      </div>
    </nav>
  </header>
  <section class="hero" id="hero">
    <div class="wrap">
      <div class="hero-logo">
        <img src="marudorilogo.png" alt="Marudori">
      </div>
      <div class="subtitle">A Nippon Hasha Brand</div>
      <div class="accent-underline" aria-hidden="true"></div>
      <div class="strap-hero">Customer Survey</div>
      <p class="lead">Tell us about your visit! Your feedback helps us serve better.</p>
      <a href="#start" id="startBtn" class="cta">Start Survey →</a>
    </div>
  </section>
  <main class="viewport" id="viewport">
    <div class="card" role="region" aria-label="Survey">
      <div class="progress" aria-hidden="true"><div id="bar" class="bar"></div></div>
      <div class="step-meta" aria-live="polite">
        <span id="stepChip" class="step-chip">Question 1 of 1</span>
        <div class="step-mini"><div id="stepMiniBar"></div></div>
      </div>
      <div class="step-hdr"><div id="stepTitle" class="step-title">1) What branch did you go to?</div></div>
      <form id="surveyForm" novalidate>
        <div class="stage" id="stage">
          <section class="step active" data-qid="1" data-required="true" data-title="1) What branch did you go to?">
            <div class="row">
              <button type="button" class="pill" data-name="q1" data-value="Marudori Rockwell">Marudori Rockwell</button>
              <button type="button" class="pill" data-name="q1" data-value="Marudori V. Corporate Building">Marudori V.Corporate Building</button>
              <input type="hidden" name="q1" required>
            </div>
          </section>
          <section class="step" data-qid="2" data-required="true" data-title="2) Is this your first time at this restaurant's branch?">
            <div class="row">
              <button type="button" class="pill" data-name="q2" data-value="Yes">Yes</button>
              <button type="button" class="pill" data-name="q2" data-value="No">No</button>
              <input type="hidden" name="q2" required>
            </div>
          </section>
          <section class="step" data-qid="3" data-required="true" data-title="3) Did you Dine-In or Take-out in the said branch?">
            <div class="row">
              <button type="button" class="pill" data-name="q3" data-value="Dine-In">Dine-In</button>
              <button type="button" class="pill" data-name="q3" data-value="Take-Out">Take-Out</button>
              <input type="hidden" name="q3" required>
            </div>
          </section>
          <section class="step" data-qid="4" data-title="4) Identifying Preferences: Any dietary restrictions or preferences?">
            <div class="row" id="q13Row">
              <button type="button" class="pill" data-name="q13" data-value="No Meat">No Meat</button>
              <button type="button" class="pill" data-name="q13" data-value="No Nuts">No Nuts</button>
              <button type="button" class="pill" data-name="q13" data-value="No Pork">No Pork</button>
              <button type="button" class="pill" data-name="q13" data-value="No Chicken">No Chicken</button>
              <button type="button" class="pill" data-name="q13" data-value="No Shrimp">No Shrimp</button>
              <button type="button" class="pill" data-name="q13" data-value="Not applicable">Not applicable</button>
              <button type="button" class="pill" data-name="q13" data-value="__other" id="q13OtherBtn">Other</button>
              <input type="hidden" name="q13">
            </div>
            <input id="q13OtherTxt" type="text" placeholder="Please specify…" style="display:none;margin-top:8px">
            <div class="hint" style="text-align:center;margin-top:6px">We’ll use this to improve menu options and suggestions.</div>
          </section>
          <section class="step" data-qid="5" data-required="true" data-title="5) How often do you visit us?">
            <div class="row">
              <button type="button" class="pill" data-name="q4" data-value="More than once a week">More than once a week</button>
              <button type="button" class="pill" data-name="q4" data-value="Once a week">Once a week</button>
              <button type="button" class="pill" data-name="q4" data-value="Twice a month">Twice a month</button>
              <button type="button" class="pill" data-name="q4" data-value="Once a month">Once a month</button>
              <button type="button" class="pill" data-name="q4" data-value="Not regularly">Not regularly</button>
              <button type="button" class="pill" data-name="q4" data-value="Not applicable">Not applicable</button>
              <input type="hidden" name="q4" required>
            </div>
          </section>
          <section class="step" data-qid="6" data-required="true" data-title="6) How would you describe your overall customer experience?">
            <div class="slider-shell slider-shell-rating" data-slider-type="rating" data-slider-input="q5" data-slider-labels="Low,Low,Low,Low,Decent,Decent,Decent,Awesome,Awesome,Awesome" data-slider-default="5">
              <div class="slider-score" id="q5Score">5</div>
              <div class="slider-score-label" id="q5ScoreLabel">DECENT</div>
              <div class="slider-track">
                <div class="slider-lane">
                  <div class="slider-fill"></div>
                  <div class="slider-thumb"><img src="ramenbowl.png" alt="Ramen bowl"></div>
                </div>
                <input id="q5Scale" class="ramen-range" type="range" min="1" max="10" step="1" value="5" aria-label="Overall experience rating">
              </div>
              <div class="slider-ticks"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div>
            </div>
            <div class="slider-followup" id="q5Follow">
              <label for="q5FollowText" id="q5FollowLabel">Tell us more about your experience</label>
              <textarea id="q5FollowText" name="q5_follow" placeholder=""></textarea>
            </div>
            <input type="hidden" name="q5" required>
          </section>
          <section class="step" data-qid="7" data-required="true" data-title="7) Did the brand offer great value for your money?">
            <div class="row">
              <button type="button" class="pill" data-name="q6" data-value="Yes">Yes</button>
              <button type="button" class="pill" data-name="q6" data-value="No">No</button>
              <input type="hidden" name="q6" required>
            </div>
          </section>
          <section class="step" data-qid="8" data-required="true" data-title="8) How would you rate the overall quality of the food served? (tastes, freshness, appearance)">
            <div class="slider-shell slider-shell-rating" data-slider-type="rating" data-slider-input="q7" data-slider-labels="Very Poor,Very Poor,Poor,Poor,Okay,Okay,Good,Good,Excellent,Excellent" data-slider-default="5">
              <div class="slider-score" id="q7Score">5</div>
              <div class="slider-score-label" id="q7ScoreLabel">OKAY</div>
              <div class="slider-track">
                <div class="slider-lane">
                  <div class="slider-fill"></div>
                  <div class="slider-thumb"><img src="ramenbowl.png" alt="Ramen bowl"></div>
                </div>
                <input id="q7Range" class="ramen-range" type="range" min="1" max="10" step="1" value="5" aria-label="Food quality rating">
              </div>
              <div class="slider-ticks"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div>
            </div>
            <input type="hidden" name="q7" required>
          </section>
          <section class="step" data-qid="9" data-required="true" data-title="9) How would you rate the friendliness of the staff you interacted with?">
            <div class="slider-shell slider-shell-rating" data-slider-type="rating" data-slider-input="q8" data-slider-labels="Very Poor,Very Poor,Poor,Poor,Okay,Okay,Good,Good,Excellent,Excellent" data-slider-default="5">
              <div class="slider-score" id="q8Score">5</div>
              <div class="slider-score-label" id="q8ScoreLabel">OKAY</div>
              <div class="slider-track">
                <div class="slider-lane">
                  <div class="slider-fill"></div>
                  <div class="slider-thumb"><img src="ramenbowl.png" alt="Ramen bowl"></div>
                </div>
                <input id="q8Range" class="ramen-range" type="range" min="1" max="10" step="1" value="5" aria-label="Staff friendliness rating">
              </div>
              <div class="slider-ticks"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div>
            </div>
            <input type="hidden" name="q8" required>
          </section>
          <section class="step" data-qid="10" data-required="true" data-title="10) Were your orders served correctly?">
            <div class="row">
              <button type="button" class="pill" data-name="q9" data-value="Yes">Yes</button>
              <button type="button" class="pill" data-name="q9" data-value="No">No</button>
              <input type="hidden" name="q9" required>
            </div>
          </section>
          <section class="step" data-qid="11" data-required="true" data-title="11) How would you rate the promptness of the service in this branch?">
            <div class="slider-shell slider-shell-rating" data-slider-type="rating" data-slider-input="q10" data-slider-labels="Very Poor,Very Poor,Poor,Poor,Okay,Okay,Good,Good,Excellent,Excellent" data-slider-default="5">
              <div class="slider-score" id="q10Score">5</div>
              <div class="slider-score-label" id="q10ScoreLabel">OKAY</div>
              <div class="slider-track">
                <div class="slider-lane">
                  <div class="slider-fill"></div>
                  <div class="slider-thumb"><img src="ramenbowl.png" alt="Ramen bowl"></div>
                </div>
                <input id="q10Range" class="ramen-range" type="range" min="1" max="10" step="1" value="5" aria-label="Service promptness rating">
              </div>
              <div class="slider-ticks"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div>
            </div>
            <input type="hidden" name="q10" required>
          </section>
          <section class="step" data-qid="12" data-required="true" data-title="12) How would you rate the overall cleanliness and orderliness of the restaurant, including the restroom, if applicable?">
            <div class="slider-shell slider-shell-rating" data-slider-type="rating" data-slider-input="q11" data-slider-labels="Very Poor,Very Poor,Poor,Poor,Okay,Okay,Good,Good,Excellent,Excellent" data-slider-default="5">
              <div class="slider-score" id="q11Score">5</div>
              <div class="slider-score-label" id="q11ScoreLabel">OKAY</div>
              <div class="slider-track">
                <div class="slider-lane">
                  <div class="slider-fill"></div>
                  <div class="slider-thumb"><img src="ramenbowl.png" alt="Ramen bowl"></div>
                </div>
                <input id="q11Range" class="ramen-range" type="range" min="1" max="10" step="1" value="5" aria-label="Cleanliness rating">
              </div>
              <div class="slider-ticks"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div>
            </div>
            <input type="hidden" name="q11" required>
          </section>
          <section class="step" data-qid="13" data-required="true" data-title="13) How likely is it that you would recommend this branch to others based on your overall experience?">
            <div class="slider-shell slider-shell-nps" data-slider-type="nps">
              <div class="slider-score" id="npsVal">5</div>
              <div class="slider-track">
                <div class="slider-lane">
                  <div class="slider-fill"></div>
                  <div class="slider-thumb"><img src="ramenbowl.png" alt="Ramen bowl"></div>
                </div>
                <input id="nps" class="ramen-range" type="range" name="q12" min="0" max="10" step="1" value="5">
              </div>
              <div class="slider-ticks"><span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div>
            </div>
            <div id="npsFollowups" style="margin-top:16px">
              <div id="npsPromoter" style="display:none">
                <label for="q12a">What is the main reason you would recommend us?</label>
                <textarea name="q12a" id="q12a" placeholder="Your reason…"></textarea>
              </div>
              <div id="npsPassive" style="display:none">
                <label for="q12b">What would make you more likely to recommend us?</label>
                <textarea name="q12b" id="q12b" placeholder="Price, portion, taste, service…"></textarea>
              </div>
              <div id="npsDetractor" style="display:none">
                <label for="q12c">What can we do better to improve your satisfaction?</label>
                <textarea name="q12c" id="q12c" placeholder="Your feedback…"></textarea>
              </div>
            </div>
          </section>
          <section class="step" data-qid="14" data-title="14) Feedback on Current Menu: Toppings or side dishes you'd like to see?">
            <textarea name="q14" placeholder="Your ideas…"></textarea>
          </section>
          <section class="step" data-qid="15" data-title="15) Testing New Ideas: Suggestions for local/seasonal ingredients to incorporate?">
            <textarea name="q15" placeholder="Your suggestions…"></textarea>
          </section>
          <section class="step" data-qid="16" data-title="16) Location: Where do you want us to open next?">
            <div class="typeahead">
              <input id="q16" name="q16" type="text" placeholder="City / Mall / Area" autocomplete="off">
              <div class="ta-list" id="q16List"></div>
            </div>
            <div class="hint" style="text-align:center;margin-top:6px">Start typing — we’ll suggest cities and malls. Use ↑/↓ + Enter to select.</div>
          </section>
          <section class="step" data-qid="17" data-title="17) What are the last five restaurants you've visited?">
            <div class="grid5">
              <input name="q17_1" placeholder="Restaurant 1">
              <input name="q17_2" placeholder="Restaurant 2">
              <input name="q17_3" placeholder="Restaurant 3">
              <input name="q17_4" placeholder="Restaurant 4">
              <input name="q17_5" placeholder="Restaurant 5">
            </div>
            <div class="hint" style="text-align:center;margin-top:6px">Free text. Auto-suggest coming later.</div>
          </section>
        </div>
        <div class="actions">
          <button type="button" id="backBtn" class="btn alt">← Back to start</button>
          <button type="button" id="nextBtn" class="btn" disabled>Next →</button>
          <button type="submit" id="submitBtn" class="btn" style="display:none">Submit Survey →</button>
        </div>
        <div id="stateMsg" class="state" aria-live="polite">Select an answer to continue.</div>
      </form>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <script>
    const hero = document.getElementById('hero');
    const viewport = document.getElementById('viewport');
    document.getElementById('startBtn').addEventListener('click',(e)=>{
      e.preventDefault();
      hero.style.transition='opacity .26s var(--ease), transform .26s var(--ease)';
      hero.style.opacity='0'; hero.style.transform='translateY(-6px)';
      setTimeout(()=>{ hero.style.display='none'; viewport.style.display='flex'; requestAnimationFrame(()=>{ refreshStageHeight(true); updateUI(); }); }, 200);
    });
    const $  = s=>document.querySelector(s);
    const $$ = s=>Array.from(document.querySelectorAll(s));
    const form = $('#surveyForm');
    const steps = $$('.step');
    const stage = $('#stage');
    const stepTitleEl = $('#stepTitle');
    const stepChipEl = $('#stepChip');
    const stepMiniBarEl = $('#stepMiniBar');
    const bar = $('#bar');
    const backBtn = $('#backBtn');
    const nextBtn = $('#nextBtn');
    const submitBtn = $('#submitBtn');
    const state = $('#stateMsg');
    const q2Hidden = form.querySelector('input[name="q2"]');
    const q4Hidden = form.querySelector('input[name="q4"]');
    const q4Step = q4Hidden ? q4Hidden.closest('.step') : null;
    let idx = 0;

    function visibleSteps(){
      return steps.filter(step => step.dataset.skip !== 'true');
    }
    function resolveTargetIndex(target, dir){
      let next = target;
      while(next >= 0 && next < steps.length && steps[next].dataset.skip === 'true'){
        next += dir;
      }
      return next;
    }
    function syncVisitFrequencyStep(){
      if(!q4Step || !q4Hidden) return;
      const firstTimer = (q2Hidden?.value || '').toLowerCase() === 'yes';
      if(firstTimer){
        q4Step.dataset.skip = 'true';
        q4Hidden.value = 'Not applicable';
        q4Hidden.dataset.autofill = 'first-time';
        $$('.row .pill[data-name="q4"]').forEach(b=>b.setAttribute('aria-pressed','false'));
      }else{
        delete q4Step.dataset.skip;
        if(q4Hidden.dataset.autofill === 'first-time'){
          q4Hidden.value = '';
          delete q4Hidden.dataset.autofill;
        }
      }
      refreshStageHeight();
      updateUI();
    }
    const PH_CITIES = [
      "Caloocan","Las Piñas","Makati","Malabon","Mandaluyong","Manila","Marikina","Muntinlupa","Navotas","Parañaque","Pasay","Pasig","Quezon City","San Juan","Taguig","Valenzuela","Pateros",
      "Alaminos","Angeles","Antipolo","Bacoor","Balanga","Batac","Batangas City","Baguio","Cabanatuan","Cabuyao","Candon","Cauayan","Cavite City","Dagupan","Dasmariñas","Gapan","General Trias","Iriga","Laoag","Legazpi","Ligao","Lipa","Lucena","Malolos","Meycauayan","Naga","Olongapo","Palayan","Puerto Princesa","San Carlos (Pangasinan)","San Fernando (La Union)","San Fernando (Pampanga)","San Jose (Nueva Ecija)","San Jose del Monte","San Pablo","Santa Rosa","Santiago","Sorsogon City","Tabuk","Tacurong","Tarlac City","Tayabas","Trece Martires","Vigan",
      "Bacolod","Bago","Bais","Bayawan","Baybay","Borongan","Calbayog","Catbalogan","Cebu City","Danao","Dumaguete","Guihulngan","Iloilo City","Kabankalan","Kananga","Lapu-Lapu","Maasin","Mandaue","Ormoc","Passi","Roxas City","Silay","Sipalay","Tagbilaran","Tacloban","Talisay (Cebu)","Talisay (Negros Occidental)","Toledo","Victorias",
      "Butuan","Cabadbaran","Cagayan de Oro","Cotabato City","Davao City","Digos","Dipolog","Dapitan","El Salvador","Gingoog","General Santos","Iligan","Isabela City","Kidapawan","Koronadal","Mati","Malaybalay","Marawi","Oroquieta","Ozamiz","Pagadian","Panabo","Samal","San Carlos (Negros Occidental)","Surigao City","Tagum","Tangub","Tandag","Valencia","Zamboanga City"
    ];
    const PH_MALLS = [
      "SM Mall of Asia","SM Megamall","SM North EDSA","SM Aura Premier","SM Southmall","SM Fairview","SM Manila","SM San Lazaro","SM Marikina","SM BF Parañaque","SM Bicutan","SM Sucat","SM Sta. Mesa",
      "Ayala Malls Glorietta","Greenbelt","Ayala Malls Manila Bay","Ayala Malls Trinoma","UP Town Center","Market! Market!","Bonifacio High Street","One Bonifacio/High Street South",
      "Robinsons Galleria","Robinsons Place Manila","Robinsons Magnolia","Robinsons Galleria South","Robinsons Metro East",
      "Festival Mall","Alabang Town Center","Power Plant Mall","Shangri-La Plaza","Estancia at Capitol Commons","The Podium","Venice Grand Canal Mall",
      "SM Seaside City Cebu","SM City Cebu","Ayala Center Cebu","Robinsons Galleria Cebu","Il Corso Lifemalls","Island Central Mactan",
      "SM Lanang Premier","Abreeza Mall","Gaisano Mall of Davao","SM City Davao","Centrio Mall CDO","SM CDO Downtown Premier","Limketkai Center",
      "SM City Baguio","SM City Clark","SM City Pampanga","MarQuee Mall","Vista Mall Bataan","Ayala Malls Harbor Point","Ayala Malls Marikina",
      "Robinsons Ilocos Norte","SM City Laoag","SM City Tuguegarao","SM City Naga","SM City Legazpi","Robinsons Naga"
    ];
    function attachTypeahead(input, list, onPick){
      const wrap = input.closest('.typeahead') || input.parentElement;
      const ul = wrap.querySelector('.ta-list') || (()=>{ const d=document.createElement('div'); d.className='ta-list'; wrap.appendChild(d); return d; })();
      let active = -1;
      function filterItems(q){
        const qv = q.trim().toLowerCase();
        if(!qv) return [];
        const seen = new Set();
        const starts = list.filter(x=>x.toLowerCase().startsWith(qv));
        const contains = list.filter(x=>!x.toLowerCase().startsWith(qv) && x.toLowerCase().includes(qv));
        return [...starts, ...contains].filter(x=>{ if(seen.has(x)) return false; seen.add(x); return true; }).slice(0,24);
      }
      function openDropdown(){ ul.style.display='block'; stage.classList.add('dropdown-open'); }
      function closeDropdown(){ ul.style.display='none'; stage.classList.remove('dropdown-open'); }
      function render(q){
        const items = filterItems(q);
        ul.innerHTML=''; active = -1;
        if(items.length===0){ closeDropdown(); return; }
        items.forEach((txt,i)=>{
          const it=document.createElement('div'); it.className='ta-item'; it.textContent=txt;
          it.addEventListener('mousedown', e=>{ e.preventDefault(); pick(txt); });
          ul.appendChild(it);
        });
        openDropdown();
      }
      function highlight(){
        [...ul.children].forEach((c,i)=> c.classList.toggle('active', i===active));
        if(active>-1){
          const el = ul.children[active];
          const top = el.offsetTop, bottom = top + el.offsetHeight;
          if(ul.scrollTop > top) ul.scrollTop = top;
          else if(ul.scrollTop + ul.clientHeight < bottom) ul.scrollTop = bottom - ul.clientHeight;
        }
      }
      function pick(val){ input.value = val; closeDropdown(); onPick?.(val); }
      input.addEventListener('input', ()=> render(input.value));
      input.addEventListener('focus', ()=> render(input.value));
      input.addEventListener('blur', ()=> setTimeout(()=>closeDropdown(), 120));
      input.addEventListener('keydown', e=>{
        const n = ul.children.length;
        if(!n) return;
        if(e.key==='ArrowDown'){ active = (active+1)%n; highlight(); e.preventDefault(); }
        else if(e.key==='ArrowUp'){ active = (active-1+n)%n; highlight(); e.preventDefault(); }
        else if(e.key==='Enter' && active>-1){ e.preventDefault(); pick(ul.children[active].textContent); }
      });
    }
    function setupPills(){
      $$('.row .pill').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const name = btn.dataset.name;
          const value = btn.dataset.value;
          const hidden = form.querySelector('input[type="hidden"][name="'+name+'"]');
          $$('.row .pill[data-name="'+name+'"]').forEach(b=>b.setAttribute('aria-pressed','false'));
          btn.setAttribute('aria-pressed','true');
          let handledBySync = false;
          if(name==='q13'){
            const otherTxt = $('#q13OtherTxt');
            if(value==='__other'){
              otherTxt.style.display='block';
              otherTxt.focus();
              hidden.value = otherTxt.value.trim();
              otherTxt.addEventListener('input', ()=>{ hidden.value = otherTxt.value.trim(); updateUI(); });
            }else{
              otherTxt.style.display='none';
              otherTxt.value='';
              hidden.value = value;
            }
            refreshStageHeight();
          }else{
            if(hidden){
              hidden.value = value;
              if(name==='q4'){ delete hidden.dataset.autofill; }
            }
            if(name==='q2'){
              handledBySync = true;
              syncVisitFrequencyStep();
            }
          }
          if(!handledBySync){ updateUI(); }
        });
      });
      $$('.row .pill').forEach(b=>b.setAttribute('aria-pressed','false'));
    }
    setupPills();
    function createSliderInstance(shell){
  if(!shell) return null;
  const range = shell.querySelector('input[type="range"]');
  if(!range) return null;
  const inst = {
    shell,
    range,
    fill: shell.querySelector('.slider-fill'),
    thumb: shell.querySelector('.slider-thumb'),
    ticks: Array.from(shell.querySelectorAll('.slider-ticks span')),
    score: shell.querySelector('.slider-score'),
    labelEl: shell.querySelector('.slider-score-label'),
    min: Number(range.min || 0),
    max: Number(range.max || 0),
    step: Number(range.step || 1),
    scoreFormatter: val => String(Math.round(val)),
    labelFormatter: null,
    commitFormatter: val => String(Math.round(val)),
    hidden: null
  };

  const hiddenAttr = shell.dataset.sliderInput || '';
  if(hiddenAttr){
    inst.hidden = form.querySelector(`input[name="${hiddenAttr}"]`);
  }else{
    const next = shell.nextElementSibling;
    if(next && next.tagName === 'INPUT' && next.type === 'hidden'){ inst.hidden = next; }
  }

  const type = shell.dataset.sliderType || '';
  const labelData = (shell.dataset.sliderLabels || '').split(',').map(l=>l.trim()).filter(Boolean);

  if(type === 'rating' && labelData.length){
    inst.labelFormatter = val => {
      const idx = Math.min(labelData.length - 1, Math.max(0, Math.round(val) - 1));
      return labelData[idx] || '';
    };
  }

  const defaultVal = Number(shell.dataset.sliderDefault ?? range.value ?? inst.min);
  if(Number.isFinite(defaultVal)) range.value = defaultVal;

  const stepSize = inst.step > 0 ? inst.step : 1;
  const rangeSpan = inst.max - inst.min;

  inst.update = value=>{
    const val = value !== undefined ? Number(value) : Number(inst.range.value);
    const ratioRaw = rangeSpan>0 ? (val - inst.min)/rangeSpan : 0;
    const pct = Math.max(0, Math.min(1, ratioRaw));
    if(inst.fill) inst.fill.style.width = `${pct*100}%`;
    if(inst.thumb) inst.thumb.style.left = `${pct*100}%`;

    if(inst.ticks.length){
      const idx = Math.min(inst.ticks.length - 1, Math.max(0, Math.round((val - inst.min)/stepSize)));
      inst.ticks.forEach((tick,i)=> tick.classList.toggle('active', i===idx));
    }

    if(inst.score){
      inst.score.textContent = inst.scoreFormatter ? inst.scoreFormatter(val) : String(Math.round(val));
    }
    if(inst.labelEl){
      const displayRaw = inst.labelFormatter ? inst.labelFormatter(val) : '';
      const display = displayRaw ? displayRaw.toUpperCase() : '';
      inst.labelEl.textContent = display;
      inst.labelEl.classList.toggle('is-empty', !display);
    }
    if(inst.hidden){
      inst.hidden.value = inst.commitFormatter ? inst.commitFormatter(val) : String(val);
    }
  };

  return inst;
}
    const ratingSliderInstances = Array.from(document.querySelectorAll('[data-slider-type="rating"]'))
      .map(createSliderInstance)
      .filter(Boolean);
    const q5Follow = $('#q5Follow');
    const q5FollowLabel = $('#q5FollowLabel');
    const q5FollowText = $('#q5FollowText');
    function updateExperienceFollowup(val){
      if(!q5Follow || !q5FollowText) return;
      const score = Number(val);
      let prompt = '';
      let placeholder = '';
      let required = false;
      if(score <= 4){
        prompt = 'What could we improve to earn a higher score?';
        placeholder = 'Share any issues you encountered…';
        required = true;
      }else if(score >= 8){
        prompt = 'Amazing! What made your experience stand out?';
        placeholder = 'Tell us what you loved…';
        required = false;
      }else{
        q5Follow.style.display = 'none';
        setRequired(q5FollowText,false);
        q5FollowText.value = '';
        refreshStageHeight();
        return;
      }
      q5Follow.style.display = 'block';
      if(q5FollowLabel){ q5FollowLabel.textContent = prompt; }
      q5FollowText.placeholder = placeholder;
      setRequired(q5FollowText, required);
      refreshStageHeight();
    }
    let experienceSliderInst = null;
    ratingSliderInstances.forEach(inst=>{
      inst.update(inst.range.value);
      if(inst.hidden?.name === 'q5'){ experienceSliderInst = inst; }
      inst.range.addEventListener('input', ()=>{
        inst.update(inst.range.value);
        if(inst.hidden?.name === 'q5'){ updateExperienceFollowup(inst.range.value); }
        updateUI();
      });
    });
    if(experienceSliderInst){ updateExperienceFollowup(experienceSliderInst.range.value); }

    const npsShell = document.querySelector('[data-slider-type="nps"]');
    const npsSliderInst = createSliderInstance(npsShell);
    const npsRange = npsSliderInst ? npsSliderInst.range : $('#nps');
    const npsPromoter = $('#npsPromoter');
    const npsPassive = $('#npsPassive');
    const npsDetractor = $('#npsDetractor');
    const q12a = $('#q12a'), q12b = $('#q12b'), q12c = $('#q12c');
    function setRequired(el, on){ if(!el) return; if(on){ el.setAttribute('required','required') } else{ el.removeAttribute('required') } }
    function updateNPSUI(val){
      if(npsSliderInst){ npsSliderInst.update(val); }
      if(npsPromoter){ npsPromoter.style.display = 'none'; }
      if(npsPassive){ npsPassive.style.display = 'none'; }
      if(npsDetractor){ npsDetractor.style.display = 'none'; }
      setRequired(q12a,false); setRequired(q12b,false); setRequired(q12c,false);
      if(val >= 9){ if(npsPromoter){ npsPromoter.style.display = 'block'; } setRequired(q12a,true); }
      else if(val >= 7){ if(npsPassive){ npsPassive.style.display = 'block'; } setRequired(q12b,true); }
      else{ if(npsDetractor){ npsDetractor.style.display = 'block'; } setRequired(q12c,true); }
      refreshStageHeight();
    }
    if(npsRange){ npsRange.addEventListener('input', ()=>{ updateNPSUI(Number(npsRange.value)); updateUI(); }); }
    syncVisitFrequencyStep();
    function measureStepHeight(i){
      const step = steps[i];
      if(!step) return 0;
      const wasActive = step.classList.contains('active');
      const prevPos = step.style.position;
      step.style.position = 'relative';
      step.style.visibility = 'hidden';
      step.style.display = 'block';
      const h = step.scrollHeight + 10;
      step.style.display = wasActive ? 'block' : 'none';
      step.style.position = prevPos || '';
      step.style.visibility = wasActive ? '' : 'hidden';
      return h;
    }
    function refreshStageHeight(initial=false){
      const targetH = measureStepHeight(idx);
      if(initial){ stage.style.height = targetH+'px'; return; }
      stage.style.height = targetH+'px';
    }
    function setProgress(i){
      const visible = visibleSteps();
      const current = steps[i];
      const total = visible.length || 1;
      const position = visible.indexOf(current);
      const at = position === -1 ? total : position + 1;
      bar.style.width = ((at / total) * 100) + '%';
      if(stepMiniBarEl){
        stepMiniBarEl.style.width = `${(at/total)*100}%`;
      }
      if(stepChipEl){
        stepChipEl.textContent = `Question ${at} of ${total}`;
      }
    }
    function stepValid(stepEl){
      if(stepEl.dataset.required === 'false') return true;
      const hidden = stepEl.querySelector('input[type="hidden"][name]');
      if(hidden){
        const otherBtn = stepEl.querySelector('#q13OtherBtn');
        const otherTxt = stepEl.querySelector('#q13OtherTxt');
        if(otherBtn && otherTxt && otherTxt.style.display === 'block'){
          return !!hidden.value && hidden.value.trim().length>0;
        }
        return !!hidden.value;
      }
      const range = stepEl.querySelector('input[type="range"]');
      if(range) return range.value !== '';
      const requiredTexts = stepEl.querySelectorAll('input[required], textarea[required]');
      for(const t of requiredTexts){
        if(t.offsetParent !== null && !t.value.trim()) return false;
      }
      return true;
    }
    function updateUI(){
      const valid = stepValid(steps[idx]);
      if(nextBtn.style.display!=='none') nextBtn.disabled = !valid;
      state.textContent = valid ? '' : 'Select an answer to continue.';
      stepTitleEl.textContent = steps[idx].dataset.title || '';
      setProgress(idx);
      backBtn.textContent = (idx===0) ? '← Back to start' : '← Back';
      nextBtn.style.display = (idx < steps.length-1) ? 'inline-block' : 'none';
      submitBtn.style.display = (idx === steps.length-1) ? 'inline-block' : 'none';
      refreshStageHeight();
    }
    let animating = false;
    function show(target, dir=1){
      if(animating) return;
      const resolved = resolveTargetIndex(target, dir);
      if(resolved<0 || resolved>=steps.length || resolved===idx) return;
      animating = true;
      const cur = steps[idx];
      const nxt = steps[resolved];
      nxt.style.display='block';
      nxt.classList.remove('exiting-left','exiting-right','entering-left','entering-right','active');
      nxt.classList.add(dir>0 ? 'entering-right' : 'entering-left');
      nxt.getBoundingClientRect();
      stage.style.height = (nxt.scrollHeight + 10) + 'px';
      cur.classList.remove('active');
      cur.classList.add(dir>0 ? 'exiting-left' : 'exiting-right');
      nxt.classList.remove('entering-right','entering-left');
      nxt.classList.add('active');
      setTimeout(()=>{
        cur.classList.remove('exiting-left','exiting-right');
        cur.style.display='none';
        idx = resolved;
        updateUI();
        animating = false;
      }, 260);
    }
    const heroEl = document.getElementById('hero');
    backBtn.addEventListener('click', ()=>{
      if(idx===0){
        viewport.style.transition='opacity .22s var(--ease), transform .22s var(--ease)';
        viewport.style.opacity='0'; viewport.style.transform='translateY(6px)';
        setTimeout(()=>{
          viewport.style.display='none';
          heroEl.style.display='grid';
          requestAnimationFrame(()=>{
            heroEl.style.opacity='1'; heroEl.style.transform='none';
          });
        }, 200);
        return;
      }
      show(idx-1,-1);
    });
    nextBtn.addEventListener('click', ()=>{ if(!nextBtn.disabled) show(idx+1,+1) });
    form.addEventListener('input',updateUI);
    form.addEventListener('change',updateUI);
    document.addEventListener('keydown',(e)=>{
      const el=document.activeElement;
      const typing = el && (el.tagName==='TEXTAREA' || (el.tagName==='INPUT' && (el.type==='text' || el.type==='range')));
      if(e.key==='Enter' && !typing){
        e.preventDefault();
        if(nextBtn.style.display!=='none' && !nextBtn.disabled) nextBtn.click();
      }
    });
    function setupQ16Typeahead(){
      const input = $('#q16');
      if(!input) return;
      const LIST = [...PH_CITIES, ...PH_MALLS];
      attachTypeahead(input, LIST, ()=>{ updateUI(); });
    }
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      state.textContent = 'Submitting…';
      submitBtn.disabled = true; nextBtn.disabled = true; backBtn.disabled = true;
      submitBtn.textContent = 'Submitting…';
      submitBtn.style.filter = 'brightness(1.05)';
      setTimeout(()=>{ submitBtn.style.filter=''; }, 300);
      setTimeout(()=>{ window.location.href = 'mrreward.html'; }, 900);
    });
    window.addEventListener('load',()=>{
      steps.forEach((s,i)=>{ s.style.display = (i===0) ? 'block' : 'none'; s.classList.toggle('active', i===0); });
      refreshStageHeight(true);
      updateUI();
      setupQ16Typeahead();
      if(npsRange){
        updateNPSUI(Number(npsRange.value));
      }
    });
    window.addEventListener('resize',()=>refreshStageHeight());
  </script>
</body>
</html>
